test:
  override:
    - cd $IMPORTPATH && go test -v -race $(go list ./... | grep -v /vendor/)
  post:
    - make packages
general:
  artifacts:
    - build
dependencies:
  pre:
    - gem install package_cloud
deployment:
  production:
    branch: master
    commands:
      # Ubuntu 14.04 (trusty), 16.04 (xenial), debian 8 (jessie), Centos6 and Centos7. (no debian 7 wheezy because that's sysvinit which we don't have packages for)
      - package_cloud push ${PACKAGECLOUD_REPO}/ubuntu/trusty build/deb-upstart/carbon-relay-ng-*.deb
      - package_cloud push ${PACKAGECLOUD_REPO}/ubuntu/xenial build/deb-systemd/carbon-relay-ng-*.deb
      - package_cloud push ${PACKAGECLOUD_REPO}/debian/jessie build/deb-systemd/carbon-relay-ng-*.deb
      - package_cloud push ${PACKAGECLOUD_REPO}/el/6          build/centos-6/carbon-relay-ng-*.el6.*.rpm
      - package_cloud push ${PACKAGECLOUD_REPO}/el/7          build/centos-7/carbon-relay-ng-*.el7.*.rpm
