<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE cases SYSTEM "../../../cases.dtd" [
        <!ENTITY % content SYSTEM "../../../Engine/Entities/definitions.inc">
        %content; ]>

<cases>
  <case name="CME certification test Process multiple gaps" disableReason="unexpected resend requst #3">
    &CLEAN_LOGS;

    <task className="FixEngine.SetGlobalConfig">
      <param name="sourceFile">./Engine/Cases/Cme/cme_config.properties</param>
    </task>

    <task className="FixEngine.EngineUpWithEchoApp">
      <param name="port">&ENGINE_PORT;</param>
      <param name="name">SERVER</param>
    </task>

    <transport className="InitiatorSocketTransport" host="localhost" port="&ENGINE_PORT;">

        <!-- logon -->
        <send>    8=FIX.4.2#9=123#35=A#34=1#49=CME#52=20031027-14:29:11.123#56=B08004N#98=0#108=5#10=000#</send>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=A#34=1#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>

        <!-- setup sequences -->
        <send>    8=FIX.4.2#9=121#35=4#34=2#369=1#52=20210329-12:31:53.478#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:31:53.478#143=US#36=7#123=Y#10=167#</send>
        
        <!-- initial package with gap -->
        <send>    8=FIX.4.2#9=322#35=8#34=7#369=10#52=20210329-12:33:07.953#49=CME#50=G#56=B08004N#57=0J4L#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9462#20=0#37=9973591975#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:07.945#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021187945197988#9717=91001008#10=215#</send>
        <send>    8=FIX.4.2#9=468#35=8#34=8#369=10#52=20210329-12:33:07.953#49=CME#50=G#56=B08004N#57=0J4L#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2422TN0000005#20=0#31=4278#32=1#37=9973591975#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:07.945#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591975202103295#1028=Y#1031=Y#1057=Y#5979=1617021187945197988#9717=91001008#37711=1844#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=077#</send>
        <send>    8=FIX.4.2#9=324#35=8#34=15#369=10#52=20210329-12:33:11.988#49=CME#50=G#56=B08004N#57=0J4L#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9470#20=0#37=9973591983#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021191978872123#9717=91001008#10=035#</send>
        <send>    8=FIX.4.2#9=470#35=8#34=16#369=10#52=20210329-12:33:11.988#49=CME#50=G#56=B08004N#57=0J4L#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2430TN0000009#20=0#31=4278#32=1#37=9973591983#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591983202103299#1028=Y#1031=Y#1057=Y#5979=1617021191978872123#9717=91001008#37711=1848#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=155#</send>
        
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=2#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=3#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=2#34=4#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#7=9#16=0#10=\d{3}#</expect>

        <!-- resend with gap -->
        <send>    8=FIX.4.2#9=354#35=8#34=9#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:08.960#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9464#20=0#37=9973591977#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:08.955#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021188955937840#9717=91001008#10=003#</send>
        <send>    8=FIX.4.2#9=501#35=8#34=10#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:08.960#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2424TN0000006#20=0#31=4278#32=1#37=9973591977#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:08.955#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591977202103296#1028=Y#1031=Y#1057=Y#5979=1617021188955937840#9717=91001008#37711=1845#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=148#</send>
        <send>    8=FIX.4.2#9=355#35=8#34=13#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:10.982#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9468#20=0#37=9973591981#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:10.971#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021190971567001#9717=91001008#10=013#</send>
        <send>    8=FIX.4.2#9=501#35=8#34=14#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:10.982#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2428TN0000008#20=0#31=4278#32=1#37=9973591981#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:10.971#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591981202103298#1028=Y#1031=Y#1057=Y#5979=1617021190971567001#9717=91001008#37711=1847#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=119#</send>
        <send>    8=FIX.4.2#9=355#35=8#34=15#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:11.988#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9470#20=0#37=9973591983#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021191978872123#9717=91001008#10=037#</send>
        <send>    8=FIX.4.2#9=501#35=8#34=16#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:11.988#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2430TN0000009#20=0#31=4278#32=1#37=9973591983#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591983202103299#1028=Y#1031=Y#1057=Y#5979=1617021191978872123#9717=91001008#37711=1848#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=148#</send>

        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=5#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=6#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=2#34=7#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#7=11#16=0#10=\d{3}#</expect>
        
        <!-- resend valid -->
        <send>    8=FIX.4.2#9=355#35=8#34=11#369=12#52=20210329-12:33:12.451#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:09.965#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9466#20=0#37=9973591979#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:09.963#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021189963563642#9717=91001008#10=047#</send>
        <send>    8=FIX.4.2#9=501#35=8#34=12#369=12#52=20210329-12:33:12.451#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:09.965#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2426TN0000007#20=0#31=4278#32=1#37=9973591979#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:09.963#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591979202103297#1028=Y#1031=Y#1057=Y#5979=1617021189963563642#9717=91001008#37711=1846#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=157#</send>
        <send>    8=FIX.4.2#9=355#35=8#34=13#369=12#52=20210329-12:33:12.451#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:10.982#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9468#20=0#37=9973591981#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:10.971#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021190971567001#9717=91001008#10=010#</send>
        <!-- session starts consuming queue and gets high seqnum that leads to unexpected resend requst -->
        <!--queue 8=FIX.4.2#9=470#35=8#34=16#369=10#52=20210329-12:33:11.988#49=CME#50=G#56=B08004N#57=0J4L#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2430TN0000009#20=0#31=4278#32=1#37=9973591983#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591983202103299#1028=Y#1031=Y#1057=Y#5979=1617021191978872123#9717=91001008#37711=1848#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=155#-->
        <!--queue 8=FIX.4.2#9=501#35=8#34=14#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:10.982#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2428TN0000008#20=0#31=4278#32=1#37=9973591981#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:10.971#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591981202103298#1028=Y#1031=Y#1057=Y#5979=1617021190971567001#9717=91001008#37711=1847#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=119#-->
        <!--queue 8=FIX.4.2#9=355#35=8#34=15#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:11.988#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9470#20=0#37=9973591983#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021191978872123#9717=91001008#10=037#-->
        <!--queue 8=FIX.4.2#9=501#35=8#34=16#369=11#52=20210329-12:33:12.149#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:11.988#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2430TN0000009#20=0#31=4278#32=1#37=9973591983#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591983202103299#1028=Y#1031=Y#1057=Y#5979=1617021191978872123#9717=91001008#37711=1848#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=148#-->
        <send>    8=FIX.4.2#9=501#35=8#34=14#369=12#52=20210329-12:33:12.451#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:10.982#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2428TN0000008#20=0#31=4278#32=1#37=9973591981#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:10.971#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591981202103298#1028=Y#1031=Y#1057=Y#5979=1617021190971567001#9717=91001008#37711=1847#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=116#</send>
        <send>    8=FIX.4.2#9=355#35=8#34=15#369=12#52=20210329-12:33:12.451#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:11.988#143=US#1=EPAM#6=0#11=91001008#14=0#17=99823:9470#20=0#37=9973591983#38=1#39=0#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#107=6ZCN1#150=0#151=1#167=FUT#432=20210329#1028=Y#1031=Y#5979=1617021191978872123#9717=91001008#10=034#</send>
        <send>    8=FIX.4.2#9=501#35=8#34=16#369=12#52=20210329-12:33:12.451#43=Y#49=CME#50=G#56=B08004N#57=0J4L#122=20210329-12:33:11.988#143=US#1=EPAM#6=0#11=91001008#14=1#17=99823:M:2430TN0000009#20=0#31=4278#32=1#37=9973591983#38=1#39=2#40=2#41=91001008#44=4278#48=997106#54=1#55=07#59=0#60=20210329-12:33:11.978#75=20210329#107=6ZCN1#150=2#151=0#167=FUT#337=TRADE#375=CME000A#432=20210329#442=1#527=9973591983202103299#1028=Y#1031=Y#1057=Y#5979=1617021191978872123#9717=91001008#37711=1848#1362=1#1363=Y1#1364=4278#1365=1#1622=11#10=145#</send>

        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=8#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=9#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=10#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>

        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=11#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=12#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=8#34=13#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect>


      <!-- send>    8=FIX.4.2#9=123#35=5#34=8#49=CME#52=20031027-14:29:11#56=B08004N#10=000#</send>
        <expect>  8=FIX\.4\.2#9=\d{1,3}#35=5#34=10#49=B08004N#52=\d{8}-\d{2}:\d{2}:\d{2}(\.\d{3})?#56=CME#10=\d{3}#</expect -->

    </transport>

    &ENGINE_DOWN;
  </case>
</cases>
